(function(e,t){"object"===typeof exports&&"object"===typeof module?module.exports=t(require("vue")):"function"===typeof define&&define.amd?define("SophosicChat",["vue"],t):"object"===typeof exports?exports["SophosicChat"]=t(require("vue")):e["SophosicChat"]=t(e["Vue"])})("undefined"!==typeof self?self:this,(e=>(()=>{"use strict";var t={8486:(e,t,s)=>{s.d(t,{default:()=>te});var n={};s.r(n);s(3792),s(3362),s(9085),s(9391),s(6280),s(6918);var a=s(154);s(2762);var r=s(9258),o=s(4048),i=s(388),c=s(9201),u=(s(8706),s(2008),s(113),s(8980),s(4346),s(8598),s(2062),s(4782),s(6910),s(9089),s(1688),s(739),s(3288),s(3110),s(9432),s(6099),s(7495),s(906),s(8781),s(7764),s(5440),s(375),s(8992),s(4520),s(2577),s(1454),s(2953),s(6031),s(3296),s(7208),s(8408),s(4603),s(7566),s(8721),s(23)),l=(s(2010),{key:0,class:"service-status"}),h={class:"status-summary"},d={class:"status-title"},m={class:"status-grid"},p={class:"status-icon"},g={class:"status-details"},v={class:"service-name"},f=["href"],w={class:"status-text"};function y(e,t,s,n,r,o){return"OK"!==o.overallStatus.status?((0,a.openBlock)(),(0,a.createElementBlock)("div",l,[(0,a.createElementVNode)("div",{class:"status-header",onClick:t[0]||(t[0]=function(e){return r.isExpanded=!r.isExpanded})},[(0,a.createElementVNode)("div",h,[(0,a.createElementVNode)("span",{class:(0,a.normalizeClass)(["dot",o.overallStatus.status.toLowerCase()])},null,2),(0,a.createElementVNode)("h3",d,(0,a.toDisplayString)(r.isExpanded?"Service Status":o.getSummaryText()),1)]),(0,a.createElementVNode)("button",{class:(0,a.normalizeClass)(["expand-button",{"is-expanded":r.isExpanded}])},t[1]||(t[1]=[(0,a.createElementVNode)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[(0,a.createElementVNode)("polyline",{points:"6 9 12 15 18 9"})],-1)]),2)]),(0,a.withDirectives)((0,a.createElementVNode)("div",m,[((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(r.services,(function(e){return(0,a.openBlock)(),(0,a.createElementBlock)("div",{key:e.name,class:"status-item"},[(0,a.createElementVNode)("div",p,[(0,a.createElementVNode)("span",{class:(0,a.normalizeClass)(["dot",e.status.toLowerCase()])},null,2)]),(0,a.createElementVNode)("div",g,[(0,a.createElementVNode)("span",v,[(0,a.createTextVNode)((0,a.toDisplayString)(e.name)+" ",1),(0,a.createElementVNode)("a",{href:e.statusPageUrl,target:"_blank",rel:"noopener noreferrer",class:"status-link",title:"View detailed status"},t[2]||(t[2]=[(0,a.createElementVNode)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[(0,a.createElementVNode)("path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"}),(0,a.createElementVNode)("polyline",{points:"15 3 21 3 21 9"}),(0,a.createElementVNode)("line",{x1:"10",y1:"14",x2:"21",y2:"3"})],-1)]),8,f)]),(0,a.createElementVNode)("span",w,(0,a.toDisplayString)(e.statusText),1)])])})),128))],512),[[a.vShow,r.isExpanded]])])):(0,a.createCommentVNode)("",!0)}var S=s(3604);s(8431),s(5086),s(3215),s(7550);const x={name:"ServiceStatus",data:function(){return{isExpanded:!1,services:[{name:"Primary AI Agent",status:"OK",statusText:"Operational",endpoint:"https://api.anthropic.com/v1/messages",model:"claude-3-5-sonnet-20241022",statusPageUrl:"https://status.anthropic.com/"},{name:"Knowledge Base",status:"OK",statusText:"Operational",components:[{name:"Vector Database",endpoint:"https://api.pinecone.io",namespace:"company-knowledgebase",statusPageUrl:"https://status.pinecone.io/"},{name:"Embeddings Service",endpoint:"https://api.openai.com/v1/embeddings",model:"text-embedding-ada-002",statusPageUrl:"https://status.openai.com/"},{name:"LLM Processing",endpoint:"https://api.groq.com/v1/chat/completions",model:"llama-3.3-70b-versatile",statusPageUrl:"https://groqstatus.com/",details:{contextLength:"128k",speed:"276 tokens/sec",pricing:{input:"$0.59/M tokens",output:"$0.79/M tokens"}}}],statusPageUrl:"https://status.pinecone.io/"},{name:"Sophosic Backend",status:"OK",statusText:"Operational",endpoint:"https://n8n.sophosic.ai",statusPageUrl:"https://status.render.com/"}],checkInterval:null}},methods:{checkServiceStatus:function(e){var t=this;return(0,i.A)((0,o.A)().mark((function s(){var n,a,r,c;return(0,o.A)().wrap((function(s){while(1)switch(s.prev=s.next){case 0:if(s.prev=0,"Knowledge Base"!==e.name){s.next=8;break}return s.next=4,Promise.all(e.components.map(function(){var e=(0,i.A)((0,o.A)().mark((function e(t){var s,n,a,r,i;return(0,o.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:n="OK",a="Operational",e.t0=t.name,e.next="Vector Database"===e.t0?5:"Embeddings Service"===e.t0?7:"LLM Processing"===e.t0?9:11;break;case 5:return s="https://status.pinecone.io/api/v2/status.json",e.abrupt("break",11);case 7:return s="https://status.openai.com/api/v2/status.json",e.abrupt("break",11);case 9:return s="https://groqstatus.com/api/v2/status.json",e.abrupt("break",11);case 11:return e.prev=11,e.next=14,fetch(s);case 14:return r=e.sent,e.next=17,r.json();case 17:i=e.sent,"none"===i.status.indicator?(n="OK",a="Operational"):"minor"===i.status.indicator?(n="WARN",a="Degraded Performance"):(n="CRIT",a="Service Disruption"),e.next=26;break;case 21:e.prev=21,e.t1=e["catch"](11),console.error("Error checking ".concat(t.name," status:"),e.t1),n="WARN",a="Status Unknown";case 26:return e.abrupt("return",{status:n,statusText:a});case 27:case"end":return e.stop()}}),e,null,[[11,21]])})));return function(t){return e.apply(this,arguments)}}()));case 4:n=s.sent,n.some((function(e){return"CRIT"===e.status}))?(e.status="CRIT",e.statusText="Service Disruption"):n.some((function(e){return"WARN"===e.status}))?(e.status="WARN",e.statusText="Degraded Performance"):n.every((function(e){return"OK"===e.status}))?(e.status="OK",e.statusText="Operational"):(e.status="WARN",e.statusText="Partially Operational"),s.next=23;break;case 8:s.t0=e.name,s.next="Primary AI Agent"===s.t0?11:"Sophosic Backend"===s.t0?13:15;break;case 11:return a="https://status.anthropic.com/api/v2/status.json",s.abrupt("break",15);case 13:return a="https://status.render.com/api/v2/status.json",s.abrupt("break",15);case 15:if(!a){s.next=23;break}return s.next=18,fetch(a);case 18:return r=s.sent,s.next=21,r.json();case 21:c=s.sent,t.updateServiceStatus(e,c);case 23:s.next=30;break;case 25:s.prev=25,s.t1=s["catch"](0),console.error("Error checking ".concat(e.name," status:"),s.t1),e.status="WARN",e.statusText="Status Unknown";case 30:case"end":return s.stop()}}),s,null,[[0,25]])})))()},updateServiceStatus:function(e,t){"none"===t.status.indicator?(e.status="OK",e.statusText="Operational"):"minor"===t.status.indicator?(e.status="WARN",e.statusText="Degraded Performance"):(e.status="CRIT",e.statusText="Service Disruption")},checkAllServices:function(){var e=this;return(0,i.A)((0,o.A)().mark((function t(){var s,n,a;return(0,o.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:s=(0,S.A)(e.services),t.prev=1,s.s();case 3:if((n=s.n()).done){t.next=9;break}return a=n.value,t.next=7,e.checkServiceStatus(a);case 7:t.next=3;break;case 9:t.next=14;break;case 11:t.prev=11,t.t0=t["catch"](1),s.e(t.t0);case 14:return t.prev=14,s.f(),t.finish(14);case 17:case"end":return t.stop()}}),t,null,[[1,11,14,17]])})))()},getSummaryText:function(){return"OK"===this.overallStatus.status?"All Systems Operational":"WARN"===this.overallStatus.status?"Degraded Performance":"CRIT"===this.overallStatus.status?"Service Disruption":"Checking System Status..."}},mounted:function(){var e=this;this.checkAllServices(),this.checkInterval=setInterval((function(){e.checkAllServices()}),3e5)},beforeUnmount:function(){this.checkInterval&&clearInterval(this.checkInterval)},computed:{overallStatus:function(){return this.services.some((function(e){return"CRIT"===e.status}))?{status:"CRIT",statusText:"Service Disruption"}:this.services.some((function(e){return"WARN"===e.status}))?{status:"WARN",statusText:"Degraded Performance"}:this.services.every((function(e){return"OK"===e.status}))?{status:"OK",statusText:"Operational"}:{status:"WARN",statusText:"Partially Operational"}}},watch:{overallStatus:{handler:function(e){this.$emit("status-changed",e)},deep:!0}}};var b=s(6262);const k=(0,b.A)(x,[["render",y]]),C=k;var E={class:"chat-container"},T={class:"system-status-content"},V={class:"status-card"},I={class:"services-grid"},N={class:"status-icon"},O={class:"status-details"},A={class:"service-header"},D={class:"service-title"},L={class:"service-name"},M=["onClick"],P=["href"],B={class:"status-text"},R={class:"component-header"},H={class:"component-name"},j=["href"],U={class:"component-details"},F={class:"component-model"};function W(e,t,s,n,r,o){return(0,a.openBlock)(),(0,a.createElementBlock)("div",E,[(0,a.createElementVNode)("div",T,[(0,a.createElementVNode)("div",V,[(0,a.createElementVNode)("div",{class:(0,a.normalizeClass)(["overall-status",s.overallStatus.status.toLowerCase()])},[(0,a.createElementVNode)("span",{class:(0,a.normalizeClass)(["dot",s.overallStatus.status.toLowerCase()])},null,2),(0,a.createElementVNode)("h2",null,(0,a.toDisplayString)(o.getSummaryText()),1)],2),(0,a.createElementVNode)("div",I,[((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(s.services,(function(e){return(0,a.openBlock)(),(0,a.createElementBlock)("div",{key:e.name,class:"status-item"},[(0,a.createElementVNode)("div",N,[(0,a.createElementVNode)("span",{class:(0,a.normalizeClass)(["dot",e.status.toLowerCase()])},null,2)]),(0,a.createElementVNode)("div",O,[(0,a.createElementVNode)("div",A,[(0,a.createElementVNode)("div",D,[(0,a.createElementVNode)("span",L,(0,a.toDisplayString)(e.name),1)]),e.components?((0,a.openBlock)(),(0,a.createElementBlock)("button",{key:0,class:(0,a.normalizeClass)(["status-link expand-button",{"is-expanded":r.expandedServices[e.name]}]),onClick:function(t){return o.toggleService(e.name)},title:"View components"},t[0]||(t[0]=[(0,a.createElementVNode)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[(0,a.createElementVNode)("polyline",{points:"6 9 12 15 18 9"})],-1)]),10,M)):((0,a.openBlock)(),(0,a.createElementBlock)("a",{key:1,href:e.statusPageUrl,target:"_blank",rel:"noopener noreferrer",class:"status-link",title:"View detailed status"},t[1]||(t[1]=[(0,a.createElementVNode)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[(0,a.createElementVNode)("path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"}),(0,a.createElementVNode)("polyline",{points:"15 3 21 3 21 9"}),(0,a.createElementVNode)("line",{x1:"10",y1:"14",x2:"21",y2:"3"})],-1)]),8,P))]),(0,a.createElementVNode)("span",B,(0,a.toDisplayString)(e.statusText),1),e.components?((0,a.openBlock)(),(0,a.createElementBlock)("div",{key:0,class:(0,a.normalizeClass)(["service-components",{expanded:r.expandedServices[e.name]}])},[((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(e.components,(function(e){return(0,a.openBlock)(),(0,a.createElementBlock)("div",{key:e.name,class:"component-item"},[(0,a.createElementVNode)("div",R,[(0,a.createElementVNode)("span",H,(0,a.toDisplayString)(e.name),1),(0,a.createElementVNode)("a",{href:e.statusPageUrl,target:"_blank",rel:"noopener noreferrer",class:"status-link",title:"View provider status"},t[2]||(t[2]=[(0,a.createElementVNode)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"10",height:"10",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[(0,a.createElementVNode)("path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"}),(0,a.createElementVNode)("polyline",{points:"15 3 21 3 21 9"}),(0,a.createElementVNode)("line",{x1:"10",y1:"14",x2:"21",y2:"3"})],-1)]),8,j)]),(0,a.createElementVNode)("div",U,[(0,a.createElementVNode)("span",F,(0,a.toDisplayString)(e.model||e.namespace),1)])])})),128))],2)):(0,a.createCommentVNode)("",!0)])])})),128))])]),t[3]||(t[3]=(0,a.createElementVNode)("div",{class:"powered-by-section"},[(0,a.createElementVNode)("a",{href:"https://sophosic.ai",target:"_blank",rel:"noopener noreferrer",class:"powered-by-link"}," Powered by Sophosic ")],-1))])])}const z={name:"SystemStatusPage",props:{services:{type:Array,required:!0},overallStatus:{type:Object,required:!0}},data:function(){return{expandedServices:{}}},methods:{getSummaryText:function(){return"OK"===this.overallStatus.status?"All Systems Operational":"WARN"===this.overallStatus.status?"Degraded Performance":"CRIT"===this.overallStatus.status?"Service Disruption":"Checking System Status..."},toggleService:function(e){this.expandedServices[e]=!this.expandedServices[e],this.$forceUpdate()}}},K=(0,b.A)(z,[["render",W],["__scopeId","data-v-3826e6aa"]]),q=K;var $={primary:"#5423E7",secondary:"#1E1B3C",background:"#F8F9FE",white:"#FFFFFF",gray:{100:"#F8F9FE",200:"#EEF0F6",300:"#E2E4ED",400:"#9CA3AF",500:"#6B7280",600:"#4B5563",700:"#374151",800:"#1E1B3C"},status:{success:"#10B981",warning:"#F59E0B",error:"#EF4444"}},_={header:{background:$.secondary,text:$.white,icons:$.white,buttons:{background:"rgba(255, 255, 255, 0.1)",hover:"rgba(255, 255, 255, 0.2)"}},launcher:{background:$.primary,shadow:"rgba(84, 35, 231, 0.1)"},messages:{background:$.background,user:{background:$.primary,text:$.white},bot:{background:$.white,text:$.secondary},timestamp:$.gray[500]},input:{background:$.background,text:$.secondary,placeholder:$.gray[500],border:$.gray[300],button:{default:$.gray[400],active:$.primary}},preview:{background:$.white,text:$.secondary,timestamp:$.gray[500],shadow:"rgba(0, 0, 0, 0.1)"},status:{ok:$.status.success,warn:$.status.warning,crit:$.status.error}};var J="https://n8n.sophosic.ai/webhook/e60704a9-52c1-47eb-9037-2344d6b56c21/chat",Y=function(e,t){0},G={name:"ChatWidget",components:{ServiceStatus:C,SystemStatusPage:q},props:{theme:{type:Object,default:function(){return{}}}},data:function(){return{sessionId:"",participants:[{id:"bot",name:"Sophia",imageUrl:"data:image/svg+xml;charset=utf-8,".concat(encodeURIComponent('\n            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 30 30">\n              <circle cx="15" cy="15" r="15" fill="#5423E7"/>\n              <text x="15" y="20" \n                font-family="Arial, sans-serif" \n                font-size="16"\n                fill="white" \n                text-anchor="middle"\n                style="pointer-events: none;">S</text>\n            </svg>\n          '))}],apiUrl:J,messageList:[],newMessagesCount:0,isChatOpen:!1,showTypingIndicator:"",newMessage:"",currentTheme:_,showHomeScreen:!0,previousChats:[],showAllChats:!1,systemStatus:{status:"OK",statusText:"Operational"},isStatusHovered:!1,showStatusPage:!1,serviceStatus:null,chatSummary:"",isKeyboardOpen:!1,viewportHeight:window.innerHeight,isMobileDevice:!1,hidePreview:!1}},computed:{displayedChats:function(){return this.showAllChats?this.previousChats:this.previousChats.slice(0,5)},isBotTyping:function(){return"bot"===this.showTypingIndicator}},created:function(){this.currentTheme=(0,c.A)((0,c.A)({},_),this.theme),this.loadSession(),this.loadPreviousChats()},mounted:function(){var e=this;return(0,i.A)((0,o.A)().mark((function t(){var s,n,a,r;return(0,o.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!(e.messageList.length>0)){t.next=18;break}return t.prev=1,t.next=4,fetch(J,{method:"GET",headers:{Accept:"application/json"},credentials:"omit"});case 4:if(s=t.sent,s.ok){t.next=7;break}throw new Error("HTTP error: ".concat(s.status));case 7:return t.next=9,s.text();case 9:n=t.sent,console.log("Initial raw response:",n),a=e.extractMessage(n),a&&"I'm here to help! How can I assist you today? (error)"!==a&&e.addMessage({author:"bot",type:"text",data:{text:a}}),t.next=18;break;case 15:t.prev=15,t.t0=t["catch"](1),console.error("Error loading initial message:",t.t0);case 18:e.$nextTick((function(){e.$refs.serviceStatus&&(e.serviceStatus=e.$refs.serviceStatus)})),e.isMobileDevice=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),e.isMobileDevice&&(window.addEventListener("resize",e.handleViewportResize),"visualViewport"in window&&window.visualViewport.addEventListener("resize",e.handleViewportResize),r=function(){var e=.01*window.innerHeight;document.documentElement.style.setProperty("--vh","".concat(e,"px"))},r(),window.addEventListener("resize",r),"visualViewport"in window&&window.visualViewport.addEventListener("resize",(function(){var t=window.visualViewport;document.documentElement.style.setProperty("--keyboard-height","".concat(window.innerHeight-t.height,"px")),e.scrollToBottom()})));case 21:case"end":return t.stop()}}),t,null,[[1,15]])})))()},beforeUnmount:function(){window.removeEventListener("resize",this.handleViewportResize),"visualViewport"in window&&window.visualViewport.removeEventListener("resize",this.handleViewportResize)},methods:{loadSession:function(){var e=localStorage.getItem("chatSessionId");e?this.sessionId=e:this.createNewSession()},createNewSession:function(){this.sessionId="session_"+Date.now()+"_"+Math.random().toString(36).substr(2,9),localStorage.setItem("chatSessionId",this.sessionId)},resetSession:function(){this.archiveSession(),this.messageList=[],this.createNewSession(),this.addMessage({author:"bot",type:"text",data:{text:"👋 Hi! I'm Sophia, an AI agent here with Valley Connection. How can I help you today?"}})},onMessageWasSent:function(e){var t=this;return(0,i.A)((0,o.A)().mark((function s(){var n,a,r,i,c,u,l,h,d;return(0,o.A)().wrap((function(s){while(1)switch(s.prev=s.next){case 0:return t.showTypingIndicator="bot",t.addMessage({author:"me",type:"text",data:{text:e.data.text},timestamp:(new Date).toISOString()}),s.prev=2,console.log("Sending message:",e.data.text),a=JSON.stringify({message:e.data.text,type:"user_message",timestamp:(new Date).toISOString(),metadata:{sessionId:t.sessionId}}),s.next=7,fetch(t.apiUrl,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},credentials:"omit",body:a});case 7:if(r=s.sent,r.ok){s.next=10;break}throw new Error("HTTP error! status: ".concat(r.status));case 10:return s.next=12,r.json();case 12:if(i=s.sent,console.log("Raw response data:",i),c=Array.isArray(i)?null===(n=i.find((function(e){return e.conversationSummary})))||void 0===n?void 0:n.conversationSummary:i.conversationSummary||"Chat session",console.log("Extracted conversation summary:",c),"Chat session"===c&&console.warn("No conversation summary found in response:",i),u=t.extractMessage(i),!(u.messages.length>0)){s.next=23;break}return l={author:"bot",type:"text",data:{text:u.messages[0]},summary:c,timestamp:(new Date).toISOString()},console.log("Adding message with summary:",l),s.next=23,t.addMessage(l);case 23:if(!(u.messages.length>1)){s.next=33;break}h=1;case 25:if(!(h<u.messages.length)){s.next=33;break}return s.next=28,new Promise((function(e){return setTimeout(e,1e3)}));case 28:return s.next=30,t.addMessage({author:"bot",type:"text",data:{text:u.messages[h]},summary:c,timestamp:(new Date).toISOString()});case 30:h++,s.next=25;break;case 33:d=t.previousChats.find((function(e){return e.sessionId===t.sessionId})),d&&(d.summary=c,t.savePreviousChats()),s.next=41;break;case 37:s.prev=37,s.t0=s["catch"](2),Y(s.t0,"Message sending failed"),t.addMessage({author:"bot",type:"text",data:{text:"I'm sorry, I'm having trouble connecting. Please try again."}});case 41:return s.prev=41,t.showTypingIndicator="",s.finish(41);case 44:case"end":return s.stop()}}),s,null,[[2,37,41,44]])})))()},extractMessage:function(e){try{var t="";if(Array.isArray(e)){var s=e.find((function(e){return e.agentResponse}));t=(null===s||void 0===s?void 0:s.agentResponse)||"I'm here to help! How can I assist you today? (error)"}else t=e.agentResponse?e.agentResponse:"I'm here to help! How can I assist you today? (error)";var n=t.split("\n").map((function(e){return e.trim()})).filter((function(e){return e.length>0})).map((function(e){return e.replace(/\\n/g,"")}));return{messages:n}}catch(a){return console.error("Error extracting message:",a),{messages:["I'm here to help! How can I assist you today? (error)"]}}},addMessage:function(e){if(!e.timestamp){var t=new Date,s=-420,n=new Date(t.getTime()+6e4*(t.getTimezoneOffset()+s));e.timestamp=n.toISOString()}console.log("Adding message:",e),this.messageList=[].concat((0,r.A)(this.messageList),[e]),this.$nextTick((function(){var e=document.querySelector(".conversation-container");e&&(e.scrollTop=e.scrollHeight)})),this.archiveSession()},openChat:function(){this.isChatOpen=!0,this.showHomeScreen=!0,this.newMessagesCount=0,this.loadPreviousChats()},closeChat:function(){this.archiveSession(),this.isChatOpen=!1},handleOnType:function(){console.log("User is typing...")},downloadTranscript:function(){var e=this.messageList.map((function(e){var t="me"===e.author?"You":"Sophia",s=e.timestamp?new Date(e.timestamp).toLocaleString("en-US",{timeZone:"America/Phoenix",hour12:!0,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}):(new Date).toLocaleString("en-US",{timeZone:"America/Phoenix"});return"".concat(s," - ").concat(t,": ").concat(e.data.text)})).join("\n\n"),t="Chat Transcript with Sophia\n"+"Generated on: ".concat((new Date).toLocaleString(),"\n")+"Session ID: ".concat(this.sessionId,"\n\n")+"".concat(e),s=new Blob([t],{type:"text/plain"}),n=window.URL.createObjectURL(s),a=document.createElement("a");a.href=n,a.download="chat-transcript-".concat((new Date).toISOString().slice(0,10),".txt"),document.body.appendChild(a),a.click(),window.URL.revokeObjectURL(n),document.body.removeChild(a)},startNewChat:function(){var e=this;this.messageList=[],this.createNewSession(),this.addMessage({author:"bot",type:"text",data:{text:"👋 Hi! I'm Sophia, an AI agent here with **Valley Connection AZ**. I can help you with:\n\n- Information about our business networking community\n- Details about our upcoming events and mastermind groups\n- Membership benefits and opportunities\n- Education & training programs like Real Estate Mastery\n- Locations of our meetings in Phoenix, Gilbert, Queen Creek, and other Valley areas\n- How to get involved with our thriving business community"},isWelcomeMessage:!0}),this.$nextTick((function(){e.addMessage({author:"bot",type:"text",data:{text:"How can I assist you today?"},isWelcomeMessage:!0,isThreaded:!0})})),this.$nextTick((function(){e.showHomeScreen=!1}))},goToHome:function(){this.archiveSession(),this.loadPreviousChats(),this.messageList=[],this.isChatOpen=!0,this.showHomeScreen=!0,this.showAllChats=!1},loadPreviousChats:function(){var e=localStorage.getItem("previousChats");if(e)try{this.previousChats=JSON.parse(e),this.previousChats.sort((function(e,t){var s=e.messages[e.messages.length-1],n=t.messages[t.messages.length-1];return new Date((null===n||void 0===n?void 0:n.timestamp)||t.timestamp)-new Date((null===s||void 0===s?void 0:s.timestamp)||e.timestamp)})),console.log("Loaded recent conversations:",this.previousChats)}catch(t){console.error("Error loading recent conversations:",t),this.previousChats=[]}},savePreviousChats:function(){this.previousChats=this.previousChats.sort((function(e,t){var s=e.messages[e.messages.length-1],n=t.messages[t.messages.length-1];return new Date((null===n||void 0===n?void 0:n.timestamp)||t.timestamp)-new Date((null===s||void 0===s?void 0:s.timestamp)||e.timestamp)})).slice(0,10),localStorage.setItem("previousChats",JSON.stringify(this.previousChats)),console.log("Saved recent conversations:",this.previousChats)},loadChat:function(e){this.showHomeScreen=!1,console.log("Loading chat:",e),this.sessionId=e.sessionId,this.messageList=(0,r.A)(e.messages),this.isChatOpen=!0,this.$nextTick((function(){var e=document.querySelector(".conversation-container");e&&(e.scrollTop=e.scrollHeight)}))},getChatPreview:function(e){var t;if(e.summary&&"Chat session"!==e.summary)return e.summary.length>50?e.summary.substring(0,50)+"...":e.summary;var s=e.messages.find((function(e){return!e.isWelcomeMessage})),n=(null===s||void 0===s||null===(t=s.data)||void 0===t?void 0:t.text)||"New chat";return n.length>50?n.substring(0,50)+"...":n},formatDate:function(e){var t=new Date(e),s=new Date,n=s-t,a=Math.floor(n/864e5),r=Math.floor(n/36e5),o=Math.floor(n/6e4),i=t.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0});if(o<1)return"Just now";if(r<1)return"".concat(o,"m ago");if(a<1)return"".concat(r,"h ago");if(t.toDateString()===s.toDateString())return"Today at ".concat(i);var c=new Date(s);return c.setDate(c.getDate()-1),t.toDateString()===c.toDateString()?"Yesterday at ".concat(i):a<7?t.toLocaleDateString("en-US",{weekday:"long"}):t.getFullYear()===s.getFullYear()?t.toLocaleDateString("en-US",{month:"short",day:"numeric"}):t.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})},archiveSession:function(){var e=this;if(this.messageList.length>0){var t=this.messageList.filter((function(e){return"bot"===e.author&&e.summary&&"Chat session"!==e.summary&&!e.isWelcomeMessage})),s="Chat session";if(t.length>0)s=t[t.length-1].summary;else{var n=this.messageList.find((function(e){return!e.isWelcomeMessage}));n&&(s=n.data.text.substring(0,50))}var a=this.messageList[this.messageList.length-1],o=(null===a||void 0===a?void 0:a.timestamp)||(new Date).toISOString(),i=this.previousChats.findIndex((function(t){return t.sessionId===e.sessionId})),c={sessionId:this.sessionId,messages:this.messageList,timestamp:o,summary:s};-1!==i?this.previousChats[i]=c:this.previousChats=[c].concat((0,r.A)(this.previousChats)),this.savePreviousChats(),console.log("Archived chat with summary:",s,"timestamp:",o)}},sendMessage:function(){if(this.newMessage.trim()){var e={data:{text:this.newMessage.trim()}};this.newMessage="",this.onMessageWasSent(e)}},renderMarkdown:function(e){try{var t=e.replace(/\\n/g,"\n").replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&#39;/g,"'").replace(/&quot;/g,'"').trim();return u.xI.setOptions({breaks:!0,sanitize:!1,gfm:!0}),(0,u.xI)(t)}catch(s){return console.error("Markdown rendering error:",s),e}},isBotThreadStart:function(e){return"me"!==this.messageList[e].author&&(0===e||"me"===this.messageList[e-1].author)},isBotThreadMiddle:function(e){return"me"!==this.messageList[e].author&&e>0&&e<this.messageList.length-1&&"me"!==this.messageList[e-1].author&&"me"!==this.messageList[e+1].author},isBotThreadEnd:function(e){return"me"!==this.messageList[e].author&&(e===this.messageList.length-1||"me"===this.messageList[e+1].author)&&e>0&&"me"!==this.messageList[e-1].author},onStatusChanged:function(e){this.systemStatus=e},showSystemStatus:function(){this.serviceStatus=this.$refs.serviceStatus,this.serviceStatus?(this.showStatusPage=!0,this.showHomeScreen=!1):console.error("ServiceStatus component not found")},getSummaryText:function(){return"OK"===this.systemStatus.status?"All Systems Operational":"WARN"===this.systemStatus.status?"Degraded Performance":"CRIT"===this.systemStatus.status?"Service Disruption":"Checking Status..."},handleInputFocus:function(){this.isMobileDevice&&(this.isKeyboardOpen=!0,this.$nextTick((function(){var e=document.querySelector(".messages-wrapper");if(e){var t=e.querySelectorAll(".message-item");if(t.length<=3)window.scrollTo(0,0);else{var s=t[t.length-1];s.scrollIntoView({behavior:"smooth"})}}})))},handleInputBlur:function(){this.isMobileDevice&&(this.isKeyboardOpen=!1)},handleViewportResize:function(){var e;if(this.isMobileDevice){var t=(null===(e=window.visualViewport)||void 0===e?void 0:e.height)||window.innerHeight,s=this.viewportHeight-t;if(t<this.viewportHeight){this.isKeyboardOpen=!0,document.documentElement.style.setProperty("--keyboard-height","".concat(s,"px"));var n=document.querySelectorAll(".message-item");n.length<=3&&window.scrollTo(0,0)}else this.isKeyboardOpen=!1,document.documentElement.style.setProperty("--keyboard-height","0px");this.viewportHeight=t}},scrollToBottom:function(){this.$nextTick((function(){var e=document.querySelector(".conversation-container");e&&(e.scrollTop=e.scrollHeight)}))},getMostRecentChatPreview:function(){return this.getMostRecentChatSummary()},resumeRecentChat:function(){if(0!==this.previousChats.length){var e=this.previousChats[0];this.loadChat(e),this.isChatOpen=!0,this.showHomeScreen=!1}},getMostRecentChatSummary:function(){if(0===this.previousChats.length)return"";var e=this.previousChats[0];return e.summary?e.summary:"New chat"},hasFollowingBotMessage:function(e){return e<this.messageList.length-1&&"me"!==this.messageList[e+1].author}}},Z=function(){(0,a.useCssVars)((function(e){return{49019088:e.currentTheme.primary,"4bf26a7a":e.currentTheme.secondary,"57b656d4":e.currentTheme.messages.background,e7dc0b96:e.currentTheme.header.background,"4cf5fb74":e.currentTheme.header.text,"4e4f507c":e.currentTheme.header.buttons.background,df190bb0:e.currentTheme.header.buttons.hover,"1d49acc9":e.currentTheme.messages.user.background,"443c2d08":e.currentTheme.messages.user.text,"50d4ef1d":e.currentTheme.messages.bot.background,"6ea68348":e.currentTheme.messages.bot.text,"35fb1cae":e.currentTheme.messages.timestamp,a657a3e8:e.currentTheme.input.background,"69059c8b":e.currentTheme.input.text,a2306f56:e.currentTheme.input.placeholder,"1fe36c0a":e.currentTheme.input.border,"6b7af563":e.currentTheme.input.button["default"],"669218b8":e.currentTheme.input.button.active,"92709e64":e.currentTheme.preview.background,"750a4e66":e.currentTheme.preview.text,"5c204d14":e.currentTheme.preview.timestamp,"5092a4c0":e.currentTheme.preview.shadow}}))},Q=G.setup;G.setup=Q?function(e,t){return Z(),Q(e,t)}:Z;function X(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!window.Vue)throw new Error("Vue is not loaded");var s=window.Vue,a=s.createApp,r=s.h,o="string"===typeof e?document.querySelector(e):e;if(!o)throw new Error("Mount element not found");var i=a({name:"SophosicChatApp",render:function(){return r(n.Widget,{config:t})}});try{return i.mount(o),i}catch(c){throw console.error("Failed to mount app:",c),c}}var ee={Widget:n.Widget,mount:X};"undefined"!==typeof window&&(window.SophosicChat=ee);const te=ee},154:t=>{t.exports=e}},s={};function n(e){var a=s[e];if(void 0!==a)return a.exports;var r=s[e]={exports:{}};return t[e].call(r.exports,r,r.exports,n),r.exports}n.m=t,(()=>{var e=[];n.O=(t,s,a,r)=>{if(!s){var o=1/0;for(l=0;l<e.length;l++){for(var[s,a,r]=e[l],i=!0,c=0;c<s.length;c++)(!1&r||o>=r)&&Object.keys(n.O).every((e=>n.O[e](s[c])))?s.splice(c--,1):(i=!1,r<o&&(o=r));if(i){e.splice(l--,1);var u=a();void 0!==u&&(t=u)}}return t}r=r||0;for(var l=e.length;l>0&&e[l-1][2]>r;l--)e[l]=e[l-1];e[l]=[s,a,r]}})(),(()=>{n.d=(e,t)=>{for(var s in t)n.o(t,s)&&!n.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})}})(),(()=>{n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()})(),(()=>{n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t)})(),(()=>{n.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}})(),(()=>{n.j=524})(),(()=>{var e={524:0};n.O.j=t=>0===e[t];var t=(t,s)=>{var a,r,[o,i,c]=s,u=0;if(o.some((t=>0!==e[t]))){for(a in i)n.o(i,a)&&(n.m[a]=i[a]);if(c)var l=c(n)}for(t&&t(s);u<o.length;u++)r=o[u],n.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return n.O(l)},s=Object("undefined"!==typeof self?self:this)["webpackChunkSophosicChat"]=Object("undefined"!==typeof self?self:this)["webpackChunkSophosicChat"]||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))})();var a=n.O(void 0,[504],(()=>n(8486)));return a=n.O(a),a=a["default"],a})()));
//# sourceMappingURL=app.js.map